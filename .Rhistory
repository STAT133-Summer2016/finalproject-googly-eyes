<<<<<<< HEAD
read_html(html_address)
library(xml2)
html_address <- "https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=0&type=T"
read_html(html_address)
html_address <- "https://movie.douban.com/tag/2015美国?start=0&type=T"
read_html(html_address)
html_address <- "https://movie.douban.com/tag/2015美国?start=0&type=T"
read_html(html_address)
table <- read_html(html_address) %>%
html_nodes(xpath = "//table") %>%
html_table(fill = TRUE)
library(dplyr)
library(stringr)
library(xml2)
library(rvest)
library(readr)
library(tidyr)
library(plyr)
table <- read_html(html_address) %>%
html_nodes(xpath = "//table") %>%
html_table(fill = TRUE)
table
table <- read_html(html_address) %>%
html_nodes(xpath = "//table[@href]") %>%
html_table(fill = TRUE)
table <- read_html(html_address) %>%
html_nodes(xpath = "//table//a") %>%
html_table(fill = TRUE)
table <- read_html(html_address) %>%
html_nodes(xpath = "//table//a") %>%
table <- read_html(html_address) %>%
html_nodes(xpath = "//table//a")
table <- read_html(html_address) %>%
html_nodes(xpath = "//table")
table
table <- read_html(html_address) %>%
table <- read_html(html_address) %>%
html_nodes(xpath = "//table[@width = '100%'") %>%
html_table(fill = T)
table <- read_html(html_address) %>%
html_nodes(xpath = "//table[@width = '100%'") %>%
html_table(fill = T)
table <- read_html(html_address) %>%
html_nodes(xpath = "//table[@class]") %>%
html_table(fill = T)
table <- read_html(html_address) %>%
html_nodes(xpath = "//div[@class = 'pl2']//a") %>%
table <- read_html(html_address) %>%
html_nodes(xpath = "//div[@class = 'pl2']//a")
table <- read_html(html_address) %>%
html_nodes(xpath = "//div[@class = 'pl2']")
table <- read_html(html_address)
html_address <- "https://movie.douban.com/tag/2015美国?start=0&type=T"
table <- read_html(html_address) %>%
html_nodes(xpath = "//div[@class = 'pl2']")
html_address <- "https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=0&type=T"
html_nodes(xpath = "//div[@class = 'pl2']")
html_address <- "https://movie.douban.com/tag/2015美国?start=0&type=T"
table <- read_html(html_address) %>%
html_nodes(xpath = "//div[@class = 'pl2']")
Sys.sleep(runif(1,1,2))
table <- read_html(html_address) %>%
html_nodes(xpath = "//div[@class = 'pl2']")
doc<-htmlParse(html_address,encoding="UTF-8")
library(XML)
doc<-htmlParse(html_address,encoding="UTF-8")
table <- read_html(html_address) %>%
html_nodes(xpath = "//div[@class = 'pl2']")
html_address <- "https://movie.douban.com/tag/2015美国?start=0&type=T"
Sys.sleep(runif(1,1,2))
doc<-htmlParse(html_address,encoding="UTF-8")
rootNode<-xmlRoot(doc)
library(XML)
URL = paste0("http://movie.douban.com/top250?format=text",1:5)
Sys.sleep(runif(1,1,2))
doc<-htmlParse(URL[1],encoding="UTF-8")
rootNode<-xmlRoot(doc)
library(XML)
URL = paste0("http://movie.douban.com/top250?format=text",1:5)
Sys.sleep(runif(1,1,2))
doc<-htmlParse(URL[1],encoding="UTF-8")
rootNode<-xmlRoot(doc)
page = "https://movie.douban.com/tag/2016?start=20&type=T" %>% read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']")
page = "https://movie.douban.com/tag/2016?start=20&type=T" %>% read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']") %>%
xml_attr("href")
name
page = "https://movie.douban.com/tag/2016?start=20&type=T" %>% read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']") %>%
page = "https://movie.douban.com/tag/2016?start=20&type=T" %>% read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']")
name
page = "https://movie.douban.com/tag/2016?start=20&type=T" %>% read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a")
name
page = "https://movie.douban.com/tag/2016?start=20&type=T" %>% read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
name
page = "https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=0&type=T" %>% read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
name
page = "https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=0&type=" %>% read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
name
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = page %>%
xml_find_all(xpath = "//span[@class = 'pl']//a") %>%
html_attr("href")
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = page %>%
xml_find_all(xpath = "//span[@class = 'pl']")
link
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = page %>%
xml_find_all(xpath = "//a")
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = page %>%
xml_find_all(xpath = "//div[@class = 'subject']//a")
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = page %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//a")
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = page %>%
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']")
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//a")
link
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']/a")
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[id = "info"]//a")
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@id = "info"]//a")
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@id = "info"]")
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div")
link
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a")
link
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href") %>%
.[length()]
movie = "https://movie.douban.com/subject/25954475" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
link
str_detect(link, "[i][m][d][b]")
link[index]
index = str_detect(link, "[i][m][d][b]")
link[index]
?seq
page_num <- seq(from = 0, to = 980, by = 20)
page_num
page_num <- seq(from = 0, to = 980, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("html"))),
stringsAsFactors=F)
View(df)
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", 20, "&type=")
html_address
index = str_detect(link, "[k][k][k][k]")
index
link <- link[index]
link
length(link)
page_num <- seq(from = 0, to = 20, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("html"))),
stringsAsFactors=F)
for i in(page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=")
page = html_address %>%
page_num <- seq(from = 0, to = 20, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("html"))),
stringsAsFactors=F)
for i in(page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=", sep = "")
page_num <- seq(from = 0, to = 20, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("html"))),
stringsAsFactors=F)
for (i in page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=", sep = "")
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = i %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
}
if (length(link) > 0) {
df <- rbind(link)
}
}
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", 20, "&type=", sep = "")
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", 20, "&type=", sep = "")
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = i %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(link)
}
}
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", 20, "&type=", sep = "")
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = j %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(link)
}
}
View(df)
View(df)
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", 20, "&type=", sep = "")
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
name
movie = "https://movie.douban.com/subject/25752261/" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(link)
}
View(df)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("link"))),
stringsAsFactors=F)
movie = "https://movie.douban.com/subject/25752261/" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(link)
}
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("link"))),
stringsAsFactors=F)
View(df)
movie = "https://movie.douban.com/subject/25752261/" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(data.framd(link))
}
movie = "https://movie.douban.com/subject/25752261/" %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(data.frame(link))
}
View(df)
page_num <- seq(from = 0, to = 20, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("link"))),
stringsAsFactors=F)
for (i in page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=", sep = "")
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = j %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(data.frame(link))
}
}
}
View(df)
View(df)
page_num <- seq(from = 0, to = 20, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("link"))),
stringsAsFactors=F)
for (i in page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=", sep = "")
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = j %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(df, data.frame(link))
}
}
}
View(df)
page_num <- seq(from = 0, to = 980, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("link"))),
stringsAsFactors=F)
for (i in page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=", sep = "")
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = j %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(df, data.frame(link))
}
}
}
View(df)
page_num <- seq(from = 80, to = 100, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("link"))),
stringsAsFactors=F)
for (i in page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=", sep = "")
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = j %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(df, data.frame(link))
}
}
}
View(df)
for (i in page_num) {
start = 0
end = 980
page_num <- seq(from = start, to = end, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("link"))),
stringsAsFactors=F)
for (i in page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=", sep = "")
print(str_c(as.character(round((i - start)/(end - start))), "%"))
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = j %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(df, data.frame(link))
}
}
}
end = 20
start = 0
end = 20
page_num <- seq(from = start, to = end, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("link"))),
stringsAsFactors=F)
for (i in page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=", sep = "")
print(str_c(as.character(round((i - start)/(end - start))), "%"))
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = j %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(df, data.frame(link))
}
}
}
start = 0
end = 20
page_num <- seq(from = start, to = end, by = 20)
df = data.frame(matrix(vector(), 0, 1,
dimnames=list(c(), c("link"))),
stringsAsFactors=F)
for (i in page_num) {
html_address <- str_c("https://movie.douban.com/tag/2015%20%E7%BE%8E%E5%9B%BD?start=", i, "&type=", sep = "")
print(str_c(as.character(round((i - start)/(end - start)*100, 2)), "%"))
page = html_address %>%
read_html()
name = page %>%
xml_find_all(xpath = "//div[@class = 'pl2']//a") %>%
html_attr("href")
for (j in name) {
movie = j %>% read_html()
link = movie %>%
xml_find_all(xpath = "//div[@class = 'subject clearfix']//div//a") %>%
html_attr("href")
index = str_detect(link, "[i][m][d][b]")
link <- link[index]
if (length(link) > 0) {
df <- rbind(df, data.frame(link))
}
}
}
View(df)
=======
str_replace_all("\\([a-zA-Z]*\\)", "")
if (length(date) == 0){
date = NA
}else{
date_str = date
date = dmy(date_str)
if (is.na(date)){
print(date_str)
next
}
}
plot_summary_attrs = page %>%
xml_find_all(xpath = "//div[@class = 'plot_summary ']
/div[@class='credit_summary_item']/h4") %>%
xml_text()
if ("Directors:" %in% plot_summary_attrs | "Director:" %in% plot_summary_attrs){
director = page %>%
xml_find_all(xpath = "//span[@itemprop = 'director']/a/span") %>%
xml_text() %>%
str_c("", collapse = ",")
}else{
director = NA
}
if ("Stars:" %in% plot_summary_attrs){
stars = page %>%
xml_find_all(xpath = "//span[@itemprop = 'actors']/a/span") %>%
xml_text() %>%
str_c(collapse = ",")
}else{
stars = NA
}
metaScore = page %>%
xml_find_all(xpath =
"//a[@href='criticreviews?ref_=tt_ov_rt']/div/span") %>%
xml_text() %>%
as.numeric()
review_users = page %>%
xml_find_all(xpath = "//a[@href='reviews?ref_=tt_ov_rt']") %>%
xml_text()
review_critics = page %>%
xml_find_all(xpath = "//a[@href='externalreviews?ref_=tt_ov_rt']") %>%
xml_text()
mPopularity = page %>%
xml_find_all("//div[@class = 'titleReviewBarSubItem']/div/span[@class = 'subText']")
if (length(mPopularity) > 1){
popularity = mPopularity %>%
.[2] %>%
xml_text() %>%
str_match("[0-9]+") %>%
as.numeric()
}else{
popularity = NA
}
classify_attrs = page %>%
xml_find_all("//div[@class = 'see-more inline canwrap']") %>%
xml_attr("itemprop")
if ("keywords" %in% classify_attrs){
keywords = page %>%
xml_find_all("//div[@class = 'see-more inline canwrap']/a") %>%
xml_attr("href")
keywords = keywords[str_detect(keywords, "keyword")] %>%
str_replace("/keyword/", "") %>%
str_replace("\\?ref_=tt_stry_kw", "") %>%
str_c("", collapse = ",")
}else{
keywords = NA
}
if ("genre" %in% classify_attrs){
genres = page %>%
xml_find_all("//div[@class = 'see-more inline canwrap']/a") %>%
xml_attr("href")
genres = genres[str_detect(genres, "genre")] %>%
str_replace("/genre/", "") %>%
str_replace("\\?ref_=tt_stry_gnr", "") %>%
str_c("", collapse = ",")
}else{
genres = NA
}
attrs = page %>%
xml_find_all("//div[@class='txt-block']/h4") %>%
xml_text()
if ("Motion Picture Rating\n                    (MPAA)\n                " %in% attrs){
contentRating = page %>%
xml_find_all("//div[@class='txt-block']/span[@itemprop = 'contentRating']") %>%
xml_text()
}else{
contentRating = NA
}
if ("Country:" %in% attrs){
country = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Country:']/following-sibling::a") %>%
xml_text() %>%
str_c(collapse = ",")
}else{
country = NA
}
if ("Language:" %in% attrs){
language = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Language:']/following-sibling::a") %>%
xml_text()  %>%
str_c("", collapse = ",")
}else{
language = NA
}
if ("Release Date:" %in% attrs){
release_date = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Release Date:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text()
}else{
release_date = NA
}
if ("Budget:" %in% attrs){
budget = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Budget:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text() %>%
str_replace_all("[ ]+", "") %>%
str_replace_all("\n", "") %>%
str_replace_all(",", "") %>%
str_replace("\\$","")
}else{
budget = NA
}
if ("Opening Weekend:" %in% attrs){
opening_week = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Opening Weekend:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text() %>%
str_replace_all("[ ]+", "") %>%
str_replace_all("\n", "") %>%
str_replace_all(",", "") %>%
str_replace("\\$","")
}else{
opening_week = NA
}
if ("Gross:" %in% attrs){
gross = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Gross:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text() %>%
str_replace_all("[ ]+", "") %>%
str_replace_all("\n", "") %>%
str_replace_all(",", "") %>%
str_replace("\\$","")
}else{
gross = NA
}
if ("Runtime:" %in% attrs){
runtime = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Runtime:']/..") %>%
xml_contents() %>%
.[4] %>%
xml_text() %>%
str_replace_all(" min", "")
}else{
runtime = NA
}
if ("Color:" %in% attrs){
color = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Color:']/..") %>%
xml_contents() %>%
.[4] %>%
xml_text()
}else{
color = NA
}
if ("Aspect Ratio:" %in% attrs){
asp = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Aspect Ratio:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text() %>%
str_replace_all(" ", "") %>%
str_replace_all("\n", "")
}else{
asp = NA
}
new_movie = c(name,
ratingValue,
# contentRating,
date,
director,
stars,
metaScore,
review_users,
review_critcs,
popularity,
keywords,
genres,
contentRating,
country,
language,
release_date,
budget,
opening_week,
gross,
runtime,
color,
asp) %>%
matrix(nrow = 1, ncol = 21)
movies_matrix = rbind(movies_matrix, new_movie)
}
movies_df = movies_matrix %>%
data.frame()
colnames(movies_df) = col_names
write_csv(movies_df, "movies_imdb.csv")
```
library(rvest)
library(readr)
library(lubridate)
library(ggplot2)
library(dplyr)
library(stringr)
library(scales)
col_names = c("name",
"ratingValue",
# contentRating,
"date",
"director",
"stars",
"metaScore",
"review_users",
"review_critcs",
"popularity",
"keywords",
"genres",
"contentRating",
"country",
"language",
"release_date",
"budget",
"opening_week",
"gross",
"runtime",
"color",
"asp")
links = read_csv("douban_2015.csv")
start = 290
i = start
end = 300
links = links[start:end,]
movies_matrix = matrix(nrow = 0, ncol = 21)
for (link in links$link){
print(str_c(as.character(i), " ", as.character(round((i-start) / (end - start) * 100, 2)), "% ",
link, sep = ""))
i = i + 1
page = link %>% read_html()
head_attrs = page %>%
xml_find_all("//div[@class='credit_summary_item']/h4") %>%
xml_text()
if ("Note:" %in% head_attrs){
print("NOOOOTTTTEEEEE")
next
}
name = page %>%
xml_find_all(xpath = "//h1[@itemprop='name']") %>%
xml_text()
ratingValue = page %>%
xml_find_all(xpath = "//div[@class = 'ratingValue']/strong") %>%
xml_attr(attr = "title")
if (length(ratingValue)==0){
ratingValue == NA
}
dateIndex = page %>%
xml_find_all(xpath = "//div[@class = 'subtext']/a") %>%
xml_attr(attr = "href") %>%
str_detect("releaseinfo")
date = page %>%
xml_find_all(xpath = "//div[@class = 'subtext']/a") %>%
.[dateIndex] %>%
xml_text() %>%
str_replace_all("\\([a-zA-Z]*\\)", "")
if (length(date) == 0){
date = NA
}else{
date_str = date
date = dmy(date_str)
if (is.na(date)){
print(date_str)
next
}
}
plot_summary_attrs = page %>%
xml_find_all(xpath = "//div[@class = 'plot_summary ']
/div[@class='credit_summary_item']/h4") %>%
xml_text()
if ("Directors:" %in% plot_summary_attrs | "Director:" %in% plot_summary_attrs){
director = page %>%
xml_find_all(xpath = "//span[@itemprop = 'director']/a/span") %>%
xml_text() %>%
str_c("", collapse = ",")
}else{
director = NA
}
if ("Stars:" %in% plot_summary_attrs){
stars = page %>%
xml_find_all(xpath = "//span[@itemprop = 'actors']/a/span") %>%
xml_text() %>%
str_c(collapse = ",")
}else{
stars = NA
}
metaScore = page %>%
xml_find_all(xpath =
"//a[@href='criticreviews?ref_=tt_ov_rt']/div/span") %>%
xml_text() %>%
as.numeric()
review_users = page %>%
xml_find_all(xpath = "//a[@href='reviews?ref_=tt_ov_rt']") %>%
xml_text()
review_critics = page %>%
xml_find_all(xpath = "//a[@href='externalreviews?ref_=tt_ov_rt']") %>%
xml_text()
mPopularity = page %>%
xml_find_all("//div[@class = 'titleReviewBarSubItem']/div/span[@class = 'subText']")
if (length(mPopularity) > 1){
popularity = mPopularity %>%
.[2] %>%
xml_text() %>%
str_match("[0-9]+") %>%
as.numeric()
}else{
popularity = NA
}
classify_attrs = page %>%
xml_find_all("//div[@class = 'see-more inline canwrap']") %>%
xml_attr("itemprop")
if ("keywords" %in% classify_attrs){
keywords = page %>%
xml_find_all("//div[@class = 'see-more inline canwrap']/a") %>%
xml_attr("href")
keywords = keywords[str_detect(keywords, "keyword")] %>%
str_replace("/keyword/", "") %>%
str_replace("\\?ref_=tt_stry_kw", "") %>%
str_c("", collapse = ",")
}else{
keywords = NA
}
if ("genre" %in% classify_attrs){
genres = page %>%
xml_find_all("//div[@class = 'see-more inline canwrap']/a") %>%
xml_attr("href")
genres = genres[str_detect(genres, "genre")] %>%
str_replace("/genre/", "") %>%
str_replace("\\?ref_=tt_stry_gnr", "") %>%
str_c("", collapse = ",")
}else{
genres = NA
}
attrs = page %>%
xml_find_all("//div[@class='txt-block']/h4") %>%
xml_text()
if ("Motion Picture Rating\n                    (MPAA)\n                " %in% attrs){
contentRating = page %>%
xml_find_all("//div[@class='txt-block']/span[@itemprop = 'contentRating']") %>%
xml_text()
}else{
contentRating = NA
}
if ("Country:" %in% attrs){
country = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Country:']/following-sibling::a") %>%
xml_text() %>%
str_c(collapse = ",")
}else{
country = NA
}
if ("Language:" %in% attrs){
language = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Language:']/following-sibling::a") %>%
xml_text()  %>%
str_c("", collapse = ",")
}else{
language = NA
}
if ("Release Date:" %in% attrs){
release_date = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Release Date:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text()
}else{
release_date = NA
}
if ("Budget:" %in% attrs){
budget = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Budget:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text() %>%
str_replace_all("[ ]+", "") %>%
str_replace_all("\n", "") %>%
str_replace_all(",", "") %>%
str_replace("\\$","")
}else{
budget = NA
}
if ("Opening Weekend:" %in% attrs){
opening_week = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Opening Weekend:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text() %>%
str_replace_all("[ ]+", "") %>%
str_replace_all("\n", "") %>%
str_replace_all(",", "") %>%
str_replace("\\$","")
}else{
opening_week = NA
}
if ("Gross:" %in% attrs){
gross = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Gross:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text() %>%
str_replace_all("[ ]+", "") %>%
str_replace_all("\n", "") %>%
str_replace_all(",", "") %>%
str_replace("\\$","")
}else{
gross = NA
}
if ("Runtime:" %in% attrs){
runtime = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Runtime:']/..") %>%
xml_contents() %>%
.[4] %>%
xml_text() %>%
str_replace_all(" min", "")
}else{
runtime = NA
}
if ("Color:" %in% attrs){
color = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Color:']/..") %>%
xml_contents() %>%
.[4] %>%
xml_text()
}else{
color = NA
}
if ("Aspect Ratio:" %in% attrs){
asp = page %>%
xml_find_all("//div[@class='txt-block']/h4[text()='Aspect Ratio:']/..") %>%
xml_contents() %>%
.[3] %>%
xml_text() %>%
str_replace_all(" ", "") %>%
str_replace_all("\n", "")
}else{
asp = NA
}
new_movie = c(name,
ratingValue,
# contentRating,
date,
director,
stars,
metaScore,
review_users,
review_critcs,
popularity,
keywords,
genres,
contentRating,
country,
language,
release_date,
budget,
opening_week,
gross,
runtime,
color,
asp) %>%
matrix(nrow = 1, ncol = 21)
movies_matrix = rbind(movies_matrix, new_movie)
}
movies_df = movies_matrix %>%
data.frame()
colnames(movies_df) = col_names
write_csv(movies_df, "movies_imdb.csv")
source('~/.active-rstudio-document', echo=TRUE)
name
date
director
date_str
page %>%
xml_find_all(xpath = "//div[@class = 'subtext']/a")
page %>%
xml_find_all(xpath = "//div[@class = 'subtext']/a") %>%
.[dateIndex]
for(i in 1:2){}
for(i in 1:2){ }
for(i in 1:2){
if (i == 2){next}}
for(i in 1:2){
if (i == 2){next}}
for (i in 1:2){
if (i == 2){
next
}
}
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
>>>>>>> 164b28ed604b4191f911fd0ab05f1b245073e56a
